version: '3'
services:
  test-api:
    build:
      context: '../'
      dockerfile: './Dockerfile'
    ports:
    - "8080:8000"
    command: python -m uvicorn cars_api.main:app --reload --host 0.0.0.0

  tests:
    build:
      context: '../'
      dockerfile: './tests/Dockerfile'
    depends_on:
      - test-api
    command: pytest /srv/tests -vvvv
    environment:
      API_BASE_URL: "http://test-api:8000"
    working_dir: /srv/tests
